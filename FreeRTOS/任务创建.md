# freertos任务的创建

## 静态创建

在指定栈中创建任务。

函数

![静态任务创建](2022-07-24-12-20-28.png)

此函数返回值为其TCB结构体，使用此函数需要对以下函数进行定义

![定义函数](2022-07-25-12-12-10.png)

## freertos优先级管理规则

Freertos 优先级值越小优先级越低

高优先级的任务先执行且高优先级的任务不主动放弃执行，则会一直执行高优先级的任务
，其他低优先级的任务无法执行

同优先级的任务交叉执行
![同优先级](2022-07-25-15-07-48.png)

## 任务的处理

### 任务删除

函数

![任务删除](2022-07-25-17-17-03.png)
任务的删除通过处理任务的TCB结构体进行任务的删除

### 利用同一个任务函数创建多个任务

![一个函数多个任务](2022-07-25-17-33-22.png)

书写一个通用函数。任务执行时，同一个函数所用的栈是不同的，任务之间不会互相影响

## 栈大小

在创建任务时，栈不可设置的太小，若设计的太小会出现数据的损坏

![开辟内存](2022-07-25-19-54-45.png)

创建一个任务

![任务](2022-07-25-20-10-26.png)

任务函数内的数据从后向前不断进行压栈操作

![函数创建变量在内存中是如何实现](2022-07-25-20-39-45.png)

当创建的任务开辟的空间过小，由于变量的创建是从后向前的会使内存的头部，TCB结构体及其头部受到影响

## 任务管理

### 任务状态

FreeRTOS通过 **tick中断** 实现任务的切换
当我们通过分析一个任务高低电平之间的时间
![高电平](2022-07-25-21-07-25.png)![低电平](2022-07-25-21-07-39.png)
我们发现中间时间大致为0.7ms接近1ms，且之后的每个任务高低电平的之间的时间都是这个数字，实际上FreeRTOS的任务切换是通过 **tick中断** 来实现的，中断的时间设置在
![时间](2022-07-25-21-12-19.png)
其任务切换如图所示

![任务切换](2022-07-25-22-05-39.png)

一个任务在FreeRTOS中有4种状态

1. running 运行状态
2. ready   就绪状态
3. blocked 阻塞状态
4. suspended 暂停状态

其转换关系如图

![状态的转换](2022-07-25-21-38-24.png)

任务的管理是通过链表(list)进行实现的，当 **tick中断** 发生时各个任务处于链表中，在链表中选择要运行的任务

任务在创建时就加入了对应的链表
![任务的TCB进入对应链表](2022-07-25-21-42-59.png)

任务的暂停也相同
![任务的暂停](2022-07-25-21-46-30.png)

### Delay与DelayUntil函数

![Delay函数](2022-07-26-13-53-42.png)

![DelayUnitl](2022-07-26-14-12-58.png)

### 空闲任务

一个任务被其他任务删除，该任务所占内存会自我释放，而任务自杀，内存则无法自我释放，这时需要空闲任务(Idle)将其所占内存释放。

空闲任务可释放自杀的任务所占内存。
空闲任务不可使其进入暂停状态(Suspended)或阻塞状态(Blocked)

### 任务调度

